×¤×§×•×“×•×ª ×œ×™×¦×™×¨×ª ×”×ª×§×™×•×ª
cd C:\repo\twitetr-server
mkdir src
cd src
mkdir config routes controllers services repositories middlewares models utils
type NUL > app.js


×¤×§×•×“×•×ª ×”×ª×§× ×”
cd C:\repo\twitetr-server
npm install express cors bcrypt jsonwebtoken dotenv @supabase/supabase-js
mpn i-y




curl -X POST http://localhost:3000/api/tweets \
  -H "Content-Type: application/json" \
  -d '{"text":"×©×œ×•× ×¢×•×œ×","author":"yoel"}'


×©×œ×™×¤×ª ×›×œ ×”×¦×™×•×¦×™×
curl http://localhost:3000/api/tweets


×©×œ×™×¤×” ×œ×¤×™ id
curl http://localhost:3000/api/tweets/1694000000000

curl -X PUT http://localhost:3000/api/tweets/1694000000000 \
  -H "Content-Type: application/json" \
  -d '{"text":"×¢×•×“×›×Ÿ! ×–×” ×”×¦×™×•×¥ ×”×—×“×©"}'

××—×™×§×”
curl -X DELETE http://localhost:3000/api/tweets/1694000000000
--------------------------------------------------------
×™×¦×™×¨×ª ×™×•×–×¨
curl -X POST http://localhost:3000/api/users \
  -H "Content-Type: application/json" \
  -d '{"username":"yoel","role":"user"}'

×©×œ×™×¤×ª ×›×œ ×”××©×ª××©×™×
curl http://localhost:3000/api/users


----------------------------------------
×™×¦×¨×” ×¢× AUTH
curl -X POST http://localhost:3000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"username":"yoel","password":"1234","role":"user"}'

LOGIN
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"yoel","password":"1234"}'


--------------------------------------DB---------------------
×™×¦×™×¨×ª ×”×˜×‘×œ××•×ª 
-- USERS: ×‘×œ×™ ××™××™×™×œ, ×¢× bcrypt hash ×•-role
create table public.users (
  id uuid primary key default gen_random_uuid(),
  username text unique not null,
  password_hash text not null,
  role text not null default 'user',
  created_at timestamp with time zone default now()
);

create index users_username_idx on public.users (username);

-- TWEETS: ×¦×™×•×¦×™× ×©×™×™×›×™× ×œ-user
create table public.tweets (
  id uuid primary key default gen_random_uuid(),
  author_id uuid not null references public.users(id) on delete cascade,
  body text not null check (char_length(body) between 1 and 500),
  created_at timestamp with time zone default now()
);

create index tweets_author_created_idx on public.tweets (author_id, created_at desc);

-- FOLLOWS: ××™ ×¢×•×§×‘ ××—×¨×™ ××™ (×˜×‘×œ×ª ×’×©×¨)
create table public.follows (
  follower_id uuid not null references public.users(id) on delete cascade,
  followed_id uuid not null references public.users(id) on delete cascade,
  created_at timestamp with time zone default now(),
  primary key (follower_id, followed_id),
  check (follower_id <> followed_id)
);

create index follows_followed_idx on public.follows (followed_id);

×”×¡×‘×¨
ğŸ§‘â€ğŸ’» users (××©×ª××©×™×)

×”×˜×‘×œ×” ×”×‘×¡×™×¡×™×ª ×‘×™×•×ª×¨ â€“ ×›×œ ××™ ×©× ×¨×©× ×œ××ª×¨.

id â€“ ××–×”×” ×™×™×—×•×“×™ (UUID).

username â€“ ×©× ×”××©×ª××© (×™×™×—×•×“×™).

password_hash â€“ ×”×¡×™×¡××” ××—×¨×™ ×©×¢×‘×¨×” bcrypt. ×œ× ×××—×¡× ×™× ×¡×™×¡×××•×ª ×’×•×œ××™×•×ª.

role â€“ ×œ××©×œ user ××• admin (×××¤×©×¨ RBAC).

created_at â€“ ××ª×™ × ×•×¦×¨ ×”××©×ª××©.

ğŸ‘‰ ×”×˜×‘×œ×” ×”×–××ª ××—×–×™×§×” ××ª ×›×œ ×”×—×©×‘×•× ×•×ª ×©×œ× ×•. ×”×™× â€œ××‘×â€ ×œ×›×œ ×”×©××¨.

ğŸ¦ tweets (×¦×™×•×¦×™×)

×›××Ÿ × ×©××¨×™× ×›×œ ×”×¤×•×¡×˜×™× (×¦×™×•×¦×™×) ×©×œ ×”××©×ª××©×™×.

id â€“ ××–×”×” ×™×™×—×•×“×™ ×œ×¦×™×•×¥.

author_id â€“ ×§×™×©×•×¨ (FK) ×œÖ¾users.id, ××™ ×›×ª×‘ ××ª ×”×¦×™×•×¥.

body â€“ ×”×˜×§×¡×˜ ×©×œ ×”×¦×™×•×¥ (×¢× ××’×‘×œ×ª ××•×¨×š, × ×’×™×“ ×¢×“ 500 ×ª×•×•×™×).

created_at â€“ ××ª×™ × ×›×ª×‘ ×”×¦×™×•×¥.

ğŸ‘‰ ×œ×›×œ ××©×ª××© ×™×›×•×œ×™× ×œ×”×™×•×ª ×›××” ×¦×™×•×¦×™×. ×”×§×©×¨ ×”×•×: User ××—×“ â†’ ×”×¨×‘×” Tweets.

ğŸ”— follows (×¢×•×§×‘×™×)

×˜×‘×œ×ª ×’×©×¨ (bridge table) â€“ ××—×‘×¨×ª ×‘×™×Ÿ ××©×ª××© ×œ×¢×•×§×‘×™× ×©×œ×•.

follower_id â€“ ××™ ×¢×•×§×‘ (FK ×œÖ¾users.id).

followed_id â€“ ××—×¨×™ ××™ ×”×•× ×¢×•×§×‘ (×’× FK ×œÖ¾users.id).

created_at â€“ ××ª×™ ×”×ª×—×™×œ ×”××¢×§×‘.

primary key (follower_id, followed_id) â€“ ×œ× ×™×›×•×œ ×œ×”×™×•×ª ×›×¤×œ ×¨×©×•××•×ª.

check (follower_id <> followed_id) â€“ ××™ ××¤×©×¨ ×œ×¢×§×•×‘ ××—×¨×™ ×¢×¦××š.

ğŸ‘‰ ×‘×–×›×•×ª ×”×˜×‘×œ×” ×”×–××ª ××¤×©×¨ ×œ×‘× ×•×ª â€œ×¤×™×“â€: ×›×©××©×ª××© × ×›× ×¡, ×©×•×œ×¤×™× ××ª ×›×œ ×”Ö¾tweets ×©×œ ×”×× ×©×™× ×©×”×•× ×¢×•×§×‘ ××—×¨×™×”×.

××™×š ×–×” ××ª×—×‘×¨?

users â† (1â†’N) â† tweets
××©×ª××© ×›×•×ª×‘ ×”×¨×‘×” ×¦×™×•×¦×™×.

users â† (Nâ†’N) â†’ users ×“×¨×š follows
××©×ª××© ××—×“ ×™×›×•×œ ×œ×¢×§×•×‘ ××—×¨×™ ×”×¨×‘×” ××—×¨×™×, ×•×œ×”×™×¤×š.

×œ××” ×©×œ×•×©×ª ××œ×” ××¡×¤×™×§×™× ×œÖ¾MVP?

×›×™ ××™×ª× ×™×© ×œ× ×•:

××¢×¨×›×ª ××©×ª××©×™× ×¢× ×”×¨×©××•×ª.

×™×›×•×œ×ª ×œ×¦×™×™×¥ ×•×œ×©×œ×•×£ ×¦×™×•×¦×™×.

×™×›×•×œ×ª ×œ×”×¦×™×’ ×¤×™×“ ××™×©×™ ×œ×¤×™ ×”×¢×•×§×‘×™×.

-----------------------------×¤×§×•×“×•×ª ×œ×‘×“×™×§×”---------------------------------

1. ×¨×™×©×•× ××©×ª××© ×—×“×©
curl -X POST http://localhost:3000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"username":"yoel","password":"1234","role":"admin"}'


ğŸ“Œ ×”×¤×œ×˜ ×™×—×–×™×¨ ×œ×š JSON ×¢× user ×•Ö¾accessToken. ×©××•×¨ ××ª ×”Ö¾accessToken.

ğŸ”‘ 2. ×”×ª×—×‘×¨×•×ª
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"yoel","password":"1234"}'


×’× ×›××Ÿ ×ª×§×‘×œ accessToken.

×©××•×¨ ××•×ª×• ×‘××©×ª× ×”:

TOKEN=PASTE_YOUR_ACCESS_TOKEN_HERE

ğŸ¦ 3. ×™×¦×™×¨×ª ×¦×™×•×¥
curl -X POST http://localhost:3000/api/tweets \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{"text":"×©×œ×•× ×˜×•×•×™×˜×¨ ××¡×•×¤××‘×™×™×¡!"}'

ğŸ“– 4. ×©×œ×™×¤×ª ×›×œ ×”×¦×™×•×¦×™×
curl http://localhost:3000/api/tweets

âœï¸ 5. ×¢×“×›×•×Ÿ ×¦×™×•×¥ (×”×—×œ×£ TWEET_ID ×‘Ö¾UUID ×©×”×ª×§×‘×œ ×‘×™×¦×™×¨×”)
curl -X PUT http://localhost:3000/api/tweets/TWEET_ID \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{"text":"×¢×•×“×›×Ÿ ××¡×•×¤××‘×™×™×¡"}'

âŒ 6. ××—×™×§×ª ×¦×™×•×¥ (×“×•×¨×© role=admin)
curl -X DELETE http://localhost:3000/api/tweets/TWEET_ID \
  -H "Authorization: Bearer $TOKEN"

ğŸ“° 7. ×¤×™×“ (×¦×™×•×¦×™× ×©×œ ××™ ×©××ª×” ×¢×•×§×‘ ××—×¨×™×•)
curl http://localhost:3000/api/tweets/feed \
  -H "Authorization: Bearer $TOKEN"

  ---------------------------×¤×§×•×“×•×ª-------
  ×”×ª×—×‘×¨×•×ª ×©×œ ×™×•××œ â†’ ×©××™×¨×ª ×˜×•×§×Ÿ ×‘××©×ª× ×”
TOKEN_YOEL=$(curl -s -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"yoel","password":"1234"}' \
  | sed -n 's/.*"accessToken":"\([^"]*\)".*/\1/p')

echo "YOEL token: ${TOKEN_YOEL:0:25}..."

2) ×”×ª×—×‘×¨×•×ª ×©×œ ××œ×™×¡ â†’ ×©××™×¨×ª ×˜×•×§×Ÿ ×•Ö¾ID
LOGIN_ALICE=$(curl -s -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"alice","password":"1234"}')

TOKEN_ALICE=$(echo "$LOGIN_ALICE" | sed -n 's/.*"accessToken":"\([^"]*\)".*/\1/p')
ALICE_ID=$(echo "$LOGIN_ALICE" | sed -n 's/.*"user":{[^}]*"id":"\([^"]*\)".*/\1/p')

echo "ALICE_ID: $ALICE_ID"
echo "ALICE token: ${TOKEN_ALICE:0:25}..."

3) ×‘×“×™×§×” ××”×™×¨×”
echo $TOKEN_YOEL
echo $TOKEN_ALICE
echo $ALICE_ID


×× ××—×“ ××”× ×¨×™×§ â†’ ××©×”×• ×œ× × ×ª×¤×¡ ×‘Ö¾sed. ×‘××§×¨×” ×›×–×” ××¤×©×¨ ×¤×©×•×˜ ×œ×”×¢×ª×™×§ ×™×“× ×™×ª ××”Ö¾JSON ×©×—×–×¨ ××”Ö¾login.

4) ×¢×›×©×™×• ×™×•××œ ×¢×•×§×‘ ××—×¨×™ ××œ×™×¡
curl -i -X POST http://localhost:3000/api/follows/$ALICE_ID \
  -H "Authorization: Bearer $TOKEN_YOEL"


× ×•×•×“× ×©×™×•××œ ×‘×××ª ×¢×•×§×‘
curl -s -H "Authorization: Bearer $TOKEN_YOEL" \
  http://localhost:3000/api/follows/me


××¦×•×¤×”: { "following": ["<ALICE_ID>"] }.

2) ××œ×™×¡ ××¦×™×™×¦×ª ××©×”×• ×œ×¤×™×“
TWEET_ALICE=$(curl -s -X POST http://localhost:3000/api/tweets \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN_ALICE" \
  -d '{"text":"×”×™×™, ×–×” ×¦×™×•×¥ ×©×œ ××œ×™×¡ ×œ×¤×™×“ ×©×œ ×™×•××œ"}')

echo "$TWEET_ALICE"


(×× ×¦×¨×™×š ××ª ×”Ö¾ID:
ALICE_TWEET_ID=$(echo "$TWEET_ALICE" | sed -n 's/.*"id":"\([^"]*\)".*/\1/p'))

3) ×™×•××œ ×¤×•×ª×— ××ª ×”×¤×™×“ ×©×œ×•
curl -s -H "Authorization: Bearer $TOKEN_YOEL" \
  http://localhost:3000/api/tweets/feed


××¦×•×¤×”: ××¢×¨×š ×¢× ×”×¦×™×•×¥ ×©×œ ××œ×™×¡ ×‘×¨××©. ×× ×™×¦× ×¨×™×§â€”××ª×” ×œ× ×¢×•×§×‘, ××• ×©××œ×™×¡ ×¢×•×“ ×œ× ×¦×™×™×¦×”. ××ª×” ×›×‘×¨ ×¢×•×§×‘, ××– ×–×” ××•××¨ ××œ×™×¡ ×œ× ×¦×™×™×¦×” â†’ ×ª×—×–×•×¨ ×œ×©×œ×‘ 2.

4) ×‘×“×™×§×ª ×”×¨×©××•×ª ×‘×¢×œ×•×ª (×©× ×‘×™×Ÿ ×©×–×” × ×¢×•×œ ×›××• ×©×¦×¨×™×š)

× × ×¡×” ×¢× ×™×•××œ ×œ×¢×“×›×Ÿ ×¦×™×•×¥ ×©×œ ××œ×™×¡â€”×××•×¨ ×œ×™×¤×•×œ 403 (××œ× ×× ×™×•××œ ××“××™×Ÿ):

curl -i -X PUT http://localhost:3000/api/tweets/$ALICE_TWEET_ID \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN_YOEL" \
  -d '{"text":"×× ×™ ×™×•××œ ×•×× ×¡×” ×œ×¢×¨×•×š ×¦×™×•×¥ ×©×œ ××œ×™×¡"}'


×•×¢×›×©×™×• ×›××œ×™×¡â€”×¦×¨×™×š ×œ×¢×‘×•×“:

curl -i -X PUT http://localhost:3000/api/tweets/$ALICE_TWEET_ID \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN_ALICE" \
  -d '{"text":"×¢×•×“×›×Ÿ ×¢\"×™ ××œ×™×¡"}'


××—×™×§×” (××•×ª×• ×¨×¢×™×•×Ÿ):

# ×™×™×¤×•×œ ×¢× ×™×•××œ (×× ×œ× ××“××™×Ÿ)
curl -i -X DELETE http://localhost:3000/api/tweets/$ALICE_TWEET_ID \
  -H "Authorization: Bearer $TOKEN_YOEL"

# ×™×¢×‘×•×“ ×¢× ××œ×™×¡
curl -i -X DELETE http://localhost:3000/api/tweets/$ALICE_TWEET_ID \
  -H "Authorization: Bearer $TOKEN_ALICE"